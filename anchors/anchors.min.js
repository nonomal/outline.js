!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Anchors=e()}(this,(function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function e(e,r,n){if(r&&!Array.isArray(r)&&"number"==typeof r.length){var s=r.length;return t(r,void 0!==n&&n<s?n:s)}return e(r,n)}function r(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(e,r){if(e){if("string"==typeof e)return t(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const n=t=>"string"==typeof t,s=t=>Object.prototype.toString.apply(t),i=t=>"function"==typeof t||"[object Function]"===s(t),o=t=>("[object Object]"===s(t)||"object"==typeof t||i(t))&&null!==t,l=t=>!!(o(t)&&t.nodeName&&t.tagName&&1===t.nodeType),a=t=>Array.isArray?Array.isArray(t):"[object Array]"===s(t),c=t=>{let e={};return null===t?null:(a(t)?e=Array.from(t):(e=Object.assign({},t),Object.keys(e).forEach((r=>e[r]=o(t[r])?c(t[r]):t[r]))),e)},h=(t,e=300)=>!!i(t)&&setTimeout((()=>{t()}),e),u=[];let d,f;function m(t){for(;t.timeRemaining()>0&&u.length;){const t=u.shift();if(!i(t))return!1;t()}u.length?d=requestIdleCallback(m):(d=0,i(f)&&(f(),f=null))}void 0===window.requestIdleCallback&&(window.requestIdleCallback=function(t){const e=Date.now();return h((function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})}),10)},window.cancelIdleCallback=function(t){clearTimeout(t)});const p=(t,e=null)=>{u.push(t),i(e)&&(f=e),d||requestIdleCallback(m)},g=t=>t*t,y=(t,e,r)=>{const s=((t=null)=>{let e,r;return t?n(t)?r=document.querySelector(t):l(t)&&(r=t):(e=document.querySelectorAll("html,body"),r=e[0].scrollTop-e[1].scrollTop>=0?e[0]:e[1]),r})(t);let o=s.scrollTop,a=0;const c=e-o,h=s.scrollHeight,u=e-h<=0?e:h,d=t=>(i(r)&&r(t),!1),f=()=>{if(a+=1,c<0){if(o-=g(a),s.scrollTop=o,o<=e)return s.scrollTop=e,d(e)}else if(o+=g(a),s.scrollTop=o,o>=u)return s.scrollTop=u,d(u);requestAnimationFrame(f)};requestAnimationFrame(f)},b=t=>{let e=t.offsetTop;return null!==t.offsetParent&&(e+=b(t.offsetParent)),e},A=(t,e="")=>{const r=e.replace(/^>/i,"");return!!(e&&r&&t)&&(t.matches?t.matches(r):!!t.msMatchesSelector&&t.msMatchesSelector(r))},T=t=>t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode,$=["focusout","blur","focusin","focus","load","unload","mouseenter","mouseleave"],v=(t,e,r)=>{const n=$.indexOf(e)>-1;r._delegateListener&&delete(r=r._delegateListener)._delegateListener,function(t,e,r){const n=t._listeners;let s=-1;if(n.length<1)return!1;n.forEach(((t,n)=>{const i=t.fn;e===t.type&&(s=n,i===r&&(s=n))})),s>-1&&n.splice(s,1)}(t,e,r),t.removeEventListener(e,r,n)},E=function(t,e,r=!1){const s=n(t)?document.querySelector(t):t,i=s.childNodes,o=((t,e)=>{let r=t._listeners||[];return n(e)&&e&&(r=r.filter((t=>t.type===e))),r})(s,e);o.forEach((t=>{v(s,t.type,t.fn)})),(r||!0===e||1===arguments.length)&&s&&i&&i.forEach((t=>{l(t)&&E(t,e,r)}))},x=(t,e,r)=>{if(!i(r))return E(t,e),!1;v(t,e,r)},L=(t,e,r,n,s,i,o=!1)=>{const l=$.indexOf(r)>-1,a=function(l){const c=function(t){const e=t.target;return(r=e)&&3===r.nodeType?r.parentNode:r;var r}(l),h=((t,e,r,n)=>{const s=r||document;if(!t)return null;do{if(null!=e&&(e.startsWith(">")?t.parentNode===s&&A(t,e):A(t,e))||n&&t===s)return t;if(t===s)break}while(t=T(t))})(c,e,t);let u=i||t;l.delegateTarget=h,!0===i&&(u=s),h&&(!0===o&&x(t,r,a),n.call(u,l,s))};if(!t)return!1;t._listeners||(t._listeners=[]),t._listeners.push({el:t,selector:e,type:r,fn:a,data:s,context:i,capture:l}),n._delegateListener=a,t.addEventListener(r,a,l)},S=[],w=(t,s="icon")=>n(t)?((t,e="icon")=>{const r=/id="(.*?)"/,n=/^(\w+)-/;return S.find((s=>{const i=r.exec(s)[1];return n.exec(i)[1]===e&&i===("icon"===e?`${e}-${t}`:`${e}-icon-${t}`)}))})(t,s):e(r,S),k=(t="")=>{const e=document.body;let r=document.querySelector("#outline-icons"),s=[];(t=>{if(!t)return!1;a(t)&&t.length>0?t.forEach((t=>{-1===S.indexOf(t)&&n(t)&&S.push(t)})):n(t)&&S.push(t)})(t),s=w(),r?r.innerHTML=s.join(""):(r=document.createElement("div"),r.innerHTML=`<svg id="outline-icons" aria-hidden="true" style="position:absolute;display:none;width:0;height:0;overflow:hidden;">${s.join("")}</svg>`,e.insertBefore(r.firstChild,e.firstChild))},j=t=>!!n(t)&&t.replace(/(^\s+)|(\s+$)/g,""),N=(t,e=!1,r=null)=>{const s=/^\d(\.|(\.\d+)*)\s?/gi,o=[];let l=1,c=0,h="";return t.forEach(((t,a)=>{const u=t.tagName,d=u.replace(/h/i,"");let f=parseInt(d,10),m=-1;var p;f>l?(c+=1,m=1===c?-1:a-1):f===l||f<l&&f>c?1===f?(c=1,m=-1):m=o[a-1].pid:f<=c&&(1===f?c=1:(c-=l-f,c<=1&&(c=1)),m=1===c?-1:((t,e,r)=>{let n,s,i=t[r-1];for(s=0;s<e;s+=1)n=i.pid,i=t[n];return n=i.pid,n})(o,l-f,a)),l=f,h=j((p=t.innerHTML,n(p)?p.replace(/<\/?[^>]+(>|$)/g,""):"")),e&&(h=j(h.replace(s,""))),i(r)&&(h=r(h)),o.push({id:a,pid:m,level:c,rel:`heading-${a}`,text:h,tagName:u})})),e?(t=>{const e={};return t.forEach((t=>{const r=JSON.stringify((t=>[t.pid])(t));e[r]=e[r]||[],e[r].push(t),t.index=e[r].length,-1===t.pid&&(t.code=String(t.index))})),Object.keys(e).forEach((t=>{e[t].forEach((t=>{const r=e[`[${t.id}]`];if(!r||!a(r))return!1;r.forEach((e=>{e.code=t.code+"."+e.index}))}))})),t})(o):o},_=t=>{const{articleElement:s,selector:o,showCode:a,chapterTextFilter:c,isTreeStructured:h}=t;let u=document.querySelector("#article"),d=[],f=[],m=null;return n(s)?u=document.querySelector(s):l(s)&&(u=s),u?(i(c)?m=c:!0===c&&(m=t=>t.replace(/\(.*?\)/,"()")),d=e(r,u.querySelectorAll(o||"h1,h2,h3,h4,h5,h6")),f=N(d,a,m),!0===h?((t,e,r)=>{const n={},s=[];return t.forEach(((t,r)=>{n[t[e]]=r,t.children=[]})),t.forEach((e=>{const i=t[n[e[r]]];-1!==e[r]?i.children.push(e):s.push(e)})),s})(f,"id","pid"):f):f},C=(t,e)=>{const r=Object.prototype.hasOwnProperty;return t&&r.call(t,e)},O={},F=t=>C(O,t)&&O[t].length>0,q=(t,e=!0)=>e?F(t):(t=>{let e=F(t),r=t.lastIndexOf(".");for(;!e&&-1!==r;)r=(t=t.substring(0,r)).lastIndexOf("."),e=F(t);return e})(t),H=(t,e,r=!0)=>{const n=t=>{if(!F(t))return!1;O[t].forEach((t=>{const r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]","[object BigInt64Array]","[object BigUint64Array]"].indexOf(s(e))>-1?e.toString():e;t.callback.call(t.context||t,r)}))},i=()=>{let e=t,r=t.lastIndexOf(".");for(;-1!==r;)e=e.substring(0,r),r=e.lastIndexOf("."),n(e);n(t),n("*")};if(!q(t))return!1;r?setTimeout(i,10):i()},I=(()=>{let t=0;return e=>(t+=1,e?e+"-"+t:"guid-"+t)})(),M=t=>{if(!C(O,t))return!1;delete O[t]},U=(t,e)=>{if(!q(t))return!1;e?(t=>{const e=Object.keys(O);if(!t||e.length<1)return!1;e.forEach((e=>{const r=O[e];let n;r.forEach(((e,s)=>{e.callback!==t&&e.token!==t||(n=e.topic,r.splice(-1,s))})),r.length<1&&M(n)}))})(e):M(t)};class R{constructor(t){this.attrs={},this.name="component",t&&this.initialize(t)}initialize(t){return this.attr(t).render().addListeners(),this}attr(t,e){const r=this.attrs;return n(t)?e&&C(r,t)?(r[t]=e,this):r[t]:o(t)?(s=r,i=t,Object.keys(i).forEach((t=>{C(i,t)&&(s[t]=i[t])})),this):0===arguments.length?r:this;var s,i}render(){return this}refresh(){return this}destroy(){return this.removeListeners(),this}reload(t){let e=this.attr();return t&&(e=this.attr(t)),this.destroy().initialize(e),this}$emit(t,e){return H(t,e),this}$on(t,e){return((t,e,r=null)=>{const n=I();let s="symbol"==typeof t?t.toString():t;i(e)&&(O[s]||(O[s]=[]),O[s].push({topic:s,callback:e,context:r,token:n}))})(t,e,this),this}$off(t,e){return U(t,e),this}addListeners(){return this}removeListeners(){return this}}const D=t=>{return!(!o(t)||!(l(t)||(t=>!(!o(t)||"[object NodeList]"!==s(t)))(t)||(e=t,o(e)&&"[object DocumentFragment]"===s(e))||(t=>!(!o(t)||!("[object Text]"===s(t)||t.tagName&&3===t.nodeType)))(t)));var e},z=(t,e)=>{const r=new RegExp("(\\s|^)"+e+"(\\s|$)");let n,s;return!!l(t)&&(n=t.className,!!n&&(s=t.classList,s&&s.contains?t.classList.contains(e):!!r.exec(n)))},B=(t,e,r)=>{let n=t.tagName.toLowerCase();switch(e){case"style":t.style.cssText=r;break;case"value":"input"===n||"textarea"===n?t.value=r:t.setAttribute(e,r);break;case"htmlFor":t.setAttribute("for",r);break;case"className":((t,e)=>{var r;let n,s;if(z(t,e))return!1;n=t.classList,null!==(r=n)&&void 0!==r&&r.add?e.indexOf(" ")>-1?e.split(" ").forEach((t=>{n.add(t)})):n.add(e):(s=t.className,s+=s.length>0?" "+e:e,t.className=s)})(t,r);break;case"innerHTML":t.innerHTML=r;break;case"innerText":t.innerText=r;break;default:t.setAttribute(e,r)}},P=(t,e)=>{if(!t||!o(e))return!1;Object.keys(e).forEach((r=>{const n=e[r];C(e,r)&&B(t,r,n)}))},J=(t,e={})=>{const r="outline-icon",s=e.size||0,i=e.color||"",o=e.iconSet||"",l=a(s)?s[0]:s,c=a(s)?s[1]:s,h=s?`width:${l}px;height:${c}px;`:"",u=i?h+`color:${i}`:h,d=e.attrs||{},f=document.createElement("i");let m,p="",g="";return n(t)?((t=>{const e=new RegExp("^\\s*(?:<\\?xml[^>]*>\\s*)?(?:<\\!doctype svg[^>]*\\s*(?:\\[?(?:\\s*<![^>]*>\\s*)*\\]?)*[^>]*>\\s*)?<svg[^>]*>[^]*<\\/svg>\\s*$\\s*$","i");return n(t)&&e.test(t)})(t)?g=t:(p=o&&"icon"!==o?`xlink:href="#${o}-icon-${t}"`:`xlink:href="#icon-${t}"`,g=`<svg><use ${p}></use></svg>`),f.innerHTML=g,d.className?d.className=`${r} ${d.className}`:d.className=r,P(f,d),m=f.querySelector("svg"),P(m,{"aria-hidden":!0,xmlns:"http://www.w3.org/2000/svg",class:"outline-icon__svg",width:200,height:200,style:u}),f):null},W=(t,e,r)=>{const s="outline-heading",l=r.hasAnchor||!0,c=r.isAtStart||!0,h=r.showCode||!1,u=r.chapterCode||"",d=r.anchorURL||"",f=r.anchorLinkFilter||null,m=`heading-${e}`,p={id:m,className:c?`${s} ${s}_start`:s,"data-id":e},g=j(t.innerHTML);let y,b,A;if(h&&(p.innerHTML=u+" "+g,p["data-code"]=u),P(t,p),!l)return!1;y=d||(i(f)?f(t.tagName.toLowerCase(),g,e):`#${m}`),A=((t,e={})=>J(t,e))("hash",{iconSet:"outline"}),b=((t,e,r)=>{const s=document.createDocumentFragment(),i=document.createElement(t),l=t=>D(t)||n(t),c=t=>{let e;if(!l(t))return!1;D(t)?e=t:n(t)&&(e=document.createTextNode(t)),s.appendChild(e)};return o(e)?P(i,e):a(e)&&e.every((t=>l(t)))?e.forEach((t=>{c(t)})):D(e)?c(e):n(e)&&c(document.createTextNode(e)),a(r)?r.forEach((t=>{c(t)})):c(r),i.appendChild(s),i})("a",{id:`anchor-${e}`,className:`${s}__anchor anchor-${e}`,href:y,target:d?"_blank":"self","data-id":e},A),t.appendChild(b)},G=(t,e)=>{var r;let n,s=t.className;if(!s||!z(t,e))return!1;n=t.classList,null!==(r=n)&&void 0!==r&&r.remove?n.remove(e):(s=j(s.replace(e,"")),t.className=s)},K=(t,e=!0,r=!0)=>{const s="outline-heading",i=t.innerHTML;let o;if(t.innerHTML=i.replace(/^\d+(\.?\d+)*\s?/gi,""),t.removeAttribute("id"),t.removeAttribute("data-id"),G(t,s),!e)return!1;var l;o=t.querySelector(`.${s}__anchor`),r&&G(t,`${s}_start`),l=j(t.className),n(l)&&""===l&&t.removeAttribute("class"),o&&t.removeChild(o)},Q=['<symbol id="outline-icon-hash" viewBox="0 0 24 24"><path d="M14.216 10l-0.444 4h-3.988l0.444-4zM15.006 2.89l-0.568 5.11h-3.988l0.543-4.89c0.061-0.549-0.335-1.043-0.883-1.104s-1.043 0.335-1.104 0.884l-0.568 5.11h-4.438c-0.552 0-1 0.448-1 1s0.448 1 1 1h4.216l-0.444 4h-3.772c-0.552 0-1 0.448-1 1s0.448 1 1 1h3.549l-0.543 4.89c-0.061 0.549 0.335 1.043 0.883 1.104s1.043-0.335 1.104-0.883l0.569-5.111h3.988l-0.543 4.89c-0.061 0.549 0.335 1.043 0.883 1.104s1.043-0.335 1.104-0.883l0.568-5.111h4.438c0.552 0 1-0.448 1-1s-0.448-1-1-1h-4.216l0.444-4h3.772c0.552 0 1-0.448 1-1s-0.448-1-1-1h-3.549l0.543-4.89c0.061-0.549-0.335-1.043-0.883-1.104s-1.043 0.335-1.104 0.883z"></path></symbol>'];class V extends R{constructor(t){super(),this.name="anchors",this._default(),t&&this.initialize(t)}_default(){return this.attrs=c(V.DEFAULTS),this.$articleElement=null,this.$scrollElement=null,this.$headings=[],this}initialize(t){let e,r,s,o;return this.attr(t),o=this.attr("articleElement"),r=this.attr("scrollElement"),e=this.attr("created"),n(o)?s=document.querySelector(o):l(o)&&(s=o),s?(this.$articleElement=s,this.$scrollElement=((t=null)=>{let e,r;return t?n(t)?r=document.querySelector(t):l(t)&&(r=t):(e=document.querySelectorAll("html,body"),r=e[0].scrollTop-e[1].scrollTop>=0?e[0]:e[1]),r})(r),this.$headings=this.getHeadings(),this.$headings.length<1||(i(e)&&e.call(this),this.render().addListeners()),this):this}getHeadings(){const t=this.$articleElement,n=this.attr("selector");return e(r,t.querySelectorAll(n))}count(){return this.getHeadings().length}render(){const t=this.attr("articleElement"),e=this.attr("selector"),r=this.attr("showCode"),n=this.attr("chapterTextFilter"),s=this.attr("mounted"),o=_({articleElement:t,selector:e,showCode:r,chapterTextFilter:n});return k(Q),this._paint(o),i(s)&&s.call(this),this}erase(){return this._remove(),this}_paint(t){const n=400,s=this.attr("hasAnchor"),i=this.attr("isAtStart"),o=this.attr("showCode"),l=this.attr("anchorURL"),a=this.attr("anchorLinkFilter"),c=this.count(),h=e(r,this.$headings),u=(e,r)=>{e.forEach(((e,c)=>{const h=c+r*n,u=t[h].code;W(e,h,{hasAnchor:s,isAtStart:i,showCode:o,chapterCode:u,anchorURL:l,anchorLinkFilter:a})}))};let d=-1;if(c>n)for(d+=1,u(h.splice(0,n),0);h.length>0;){const t=h.splice(0,n);p((()=>{u(t,d+=1)}),(()=>{this.$emit("anchors:all:paint")}))}else u(h,0);return this}_remove(){const t=this.attr("hasAnchor"),e=this.attr("isAtStart");return this.$headings.forEach((r=>{K(r,t,e)})),this}refresh(t){const e=this.attr("articleElement"),r=this.attr("selector"),n=this.attr("showCode"),s=this.attr("chapterTextFilter");return this.$headings=this.getHeadings(),this.erase()._paint(t||_({articleElement:e,selector:r,showCode:n,chapterTextFilter:s})),this}scrollTo(t,e){const r=this.$scrollElement;return y(r,t,e),this}destroy(){const t=this.attr("beforeDestroy"),e=this.attr("afterDestroy");return i(t)&&t.call(this),this.removeListeners()._remove()._default(),i(e)&&e.call(this),this}onAnchorTrigger(t){const e=this.attr("anchorURL"),r=this.attr("afterScroll"),n=this.attr("stickyHeight"),s=t.delegateTarget.parentNode,o=b(s)-(n+10),l=this.$scrollElement,a=l.scrollHeight-l.clientHeight;return this.scrollTo(o,(()=>{i(r)&&r.call(this,"anchor"),h((()=>{this.$emit("toolbar:update",{top:o,min:0,max:a})}))})),e||function(t){t.stopPropagation(),t.preventDefault()}(t),this}onRefresh(t){return this.refresh(t),this}addListeners(){const t=this.$articleElement;return this.count()<1||(L(t,".outline-heading__anchor","click",this.onAnchorTrigger,this,!0),this.$on("anchors:refresh",this.onRefresh)),this}removeListeners(){const t=this.$articleElement;return this.count()<1||(x(t,"click",this.onAnchorTrigger),this.$off("anchors:refresh",this.onRefresh)),this}}return V.DEFAULTS=c({scrollElement:"html,body",articleElement:"#article",selector:"h1,h2,h3,h4,h5,h6",stickyHeight:0,anchorURL:"",hasAnchor:!0,isAtStart:!0,showCode:!1,created:null,mounted:null,afterScroll:null,beforeDestroy:null,afterDestroy:null,chapterTextFilter:null,anchorLinkFilter:null}),V}));
//# sourceMappingURL=anchors.min.js.map
