!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Chapters=e()}(this,(function(){"use strict";const t=t=>"string"==typeof t,e=(t,e)=>{const s=Object.prototype.hasOwnProperty;return t&&s.call(t,e)},s=Object.prototype.toString;class i{constructor(t){this.attrs={},t&&this.initialize(t)}initialize(t){return this.attr(t).render().addListeners(),this}attr(i,l){const r=this.attrs;return t(i)?l&&e(r,i)?(r[i]=l,this):r[i]:(a=i,"[object Object]"===s.apply(a)&&null!==a?(n=r,o=i,Object.keys(o).forEach((t=>{e(o,t)&&(n[t]=o[t])})),this):0===arguments.length?r:this);var n,o,a}render(){return this}destroy(){return this.removeListeners(),this}reload(t){return this.destroy().initialize(this.attr(t)),this}addListeners(){return this}removeListeners(){return this}}const l=t=>"function"==typeof t||"[object Function]"===s.apply(t),r=t=>t&&t.nodeName&&t.tagName&&1===t.nodeType,n=(t,e=300)=>!!l(t)&&setTimeout((()=>{t()}),e),o=["focusout","blur","focusin","focus","load","unload","mouseenter","mouseleave"],a=(t,e,s)=>{const i=o.indexOf(e)>-1;s._delegateListener&&delete(s=s._delegateListener)._delegateListener,function(t,e,s){const i=t._listeners;let l=-1;if(i.length<1)return!1;i.forEach(((t,i)=>{const r=t.fn;e===t.type&&(l=i,r===s&&(l=i))})),l>-1&&i.splice(l,1)}(t,e,s),t.removeEventListener(e,s,i)},c=function(e,s,i=!1){const l=t(e)?document.querySelector(e):e,n=l.childNodes,o=((e,s)=>{let i=e._listeners||[];return t(s)&&s&&(i=i.filter((t=>t.type===s))),i})(l,s);o.forEach((t=>{a(l,t.type,t.fn)})),(i||!0===s||1===arguments.length)&&l&&n&&n.forEach((t=>{r(t)&&c(t,s,i)}))},h=(t,e,s)=>{if(!l(s))return c(t,e);a(t,e,s)},u=(t,e="")=>{const s=e.replace(/^>/i,"");return!!(e&&s&&t)&&(t.matches?t.matches(s):!!t.msMatchesSelector&&t.msMatchesSelector(s))},d=t=>t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode,p=(t,e,s,i,l,r,n=!1)=>{const a=o.indexOf(s)>-1,c=function(o){const a=function(t){const e=t.target;return(s=e)&&3===s.nodeType?s.parentNode:s;var s}(o),p=((t,e,s,i)=>{const l=s||document;if(!t)return null;do{if(null!=e&&(">"===e[0]?t.parentNode===l&&u(t,e):u(t,e))||i&&t===l)return t;if(t===l)break}while(t=d(t))})(a,e,t);let m=r||t;o.delegateTarget=p,!0===r&&(m=l),p&&(!0===n&&h(t,s,c),i.call(m,o,l))};t._listeners||(t._listeners=[]),t._listeners.push({el:t,selector:e,type:s,fn:c,data:l,context:r,capture:a}),i._delegateListener=c,t.addEventListener(s,c,a)},m=(t,i,l)=>{const n=Object.keys(i);let o=document.createElement(t);var a;return n.forEach((t=>{e(i,t)&&((t,e,s)=>{let i=t.tagName.toLowerCase();switch(e){case"style":t.style.cssText=s;break;case"value":"input"===i||"textarea"===i?t.value=s:t.setAttribute(e,s);break;case"className":t.className=s;break;default:t.setAttribute(e,s)}})(o,t,i[t])})),a=l,(Array.isArray?Array.isArray(a):"[object Array]"===s.apply(a))&&l.forEach((t=>{let e=r(t)?t:document.createTextNode(t);o.appendChild(e)})),o},f=t=>t*t,y=(e=null)=>{let s,i;return e?t(e)?i=document.querySelector(e):r(e)&&(i=e):(s=document.querySelectorAll("html,body"),i=s[0].scrollTop-s[1].scrollTop>=0?s[0]:s[1]),i};let g=null;const $=(t,e)=>{let s=t.className;return!!s&&s.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},b=(t,e)=>{let s=t.className;if($(t,e))return!1;s+=s.length>0?" "+e:e,t.className=s},v=(e,s)=>{let i=e.className;if(!i||!$(e,s))return!1;var l;l=i.replace(s,""),i=!!t(l)&&l.replace(/^\s+|\s+$/g,""),e.className=i},E=t=>{let e=t.offsetTop;return null!==t.offsetParent&&(e+=E(t.offsetParent)),e},_={},T=t=>e(_,t)&&_[t].length>0,x=(t,e=!0)=>e?T(t):(t=>{let e=T(t),s=t.lastIndexOf(".");for(;!e&&-1!==s;)s=(t=t.substring(0,s)).lastIndexOf("."),e=T(t);return e})(t),N=(t,e,i=!0)=>{const l=t=>{if(!T(t))return!1;_[t].forEach((t=>{const i=(l=e,["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]","[object BigInt64Array]","[object BigUint64Array]"].indexOf(s.call(l))>-1?e.toString():e);var l;t.callback.call(t.context||t,i)}))},r=()=>{let e=t,s=t.lastIndexOf(".");for(;-1!==s;)e=e.substring(0,s),s=e.lastIndexOf("."),l(e);l(t),l("*")};if(!x(t))return!1;i?setTimeout(r,10):r()};class S extends i{constructor(t){super(),this.attrs=S.DEFAULTS,this.$el=null,this.$title=null,this.$main=null,this.$list=null,this.$placeholder=null,this.$parentElement=null,this.$scrollElement=null,this.chapters=[],this.closed=!1,this.active=0,this.offsetTop=0,this.$active=null,this.timer=null,this.playing=!1,t&&this.initialize(t)}initialize(e){let s,i,n,o;return this.attr(e),s=this.attr("created"),i=this.attr("parentElement"),n=this.attr("scrollElement"),t(i)?o=document.querySelector(i):r(i)&&(o=i),this.$parentElement=o,this.$scrollElement=y(n),this.chapters=this.attr("chapters"),this.closed=this.attr("closed"),this.active=this.attr("active"),l(s)&&s.call(this),this.chapters.length<1||(this.render().addListeners(),this.$active=document.querySelector(`#chapter-${this.active}`)),this}isClosed(){return this.closed}isSticky(){return"sticky"===this.attr("position")}isFixed(){return"fixed"===this.attr("position")}isInside(){return this.isFixed()||this.isSticky()}isOutside(){return!this.isInside()}render(){const t=this.attr("mounted"),e=this.attr("title"),s=this.attr("showCode"),i=this.attr("customClass"),r=this.$parentElement,n=[];let o,a,c,h,u=null;return r?(this.isInside()&&(u=m("h2",{className:"outline-chapters__title"},[e]),this.$title=u,n.push(u)),c=m("ul",{className:"outline-chapters__list"},[""]),this.$list=c,h=m("div",{className:"outline-chapters__placeholder"},[""]),this.$placeholder=h,a=m("div",{className:"outline-chapters__main"},[c,h]),this.$main=a,n.push(a),o=m("nav",{id:"outline-chapters",className:"outline-chapters"},n),this.$el=o,this.isSticky()&&b(o,"outline-chapters_sticky"),i&&b(o,i),r.appendChild(o),((t,e,s=!1)=>{e.forEach((e=>{const i=e.pid,l=m("span",{className:"outline-chapters__text"},[e.text]),r=m("a",{id:`outline-anchor-${e.id}`,className:"outline-chapters__anchor",href:"#"+e.rel,rel:e.rel,"data-id":e.id},[l]);let n,o,a,c,h=[];s&&(c=m("span",{className:"outline-chapters__code","data-id":e.id},[e.code]),r.insertBefore(c,r.firstChild)),h.push(r),a=m("li",{id:`outline-chapter-${e.id}`,className:"outline-chapters__item","data-id":e.id},h),-1===i?t.appendChild(a):(n=document.getElementById("outline-chapter-"+i),o=document.getElementById("outline-subject-"+i),o?o.appendChild(a):(o=m("ul",{id:"outline-subject-"+i,className:"outline-chapters__subject"},[a]),n.appendChild(o)))}))})(c,this.chapters,s),this.offsetTop=E(document.querySelector("#outline-chapters")),l(t)&&t.call(this),this.onObserver(),this):this}highlight(t){const e=this.$el.querySelector(`#outline-anchor-${t}`),s="outline-chapters_active",i=this.$placeholder;let l;return this.$active&&v(this.$active,s),this.active=parseInt(e.getAttribute("data-id"),10),this.$active=e,b(this.$active,s),l=30*this.active,i.style.top=`calc(0.5em + ${l}px)`,this}sticky(){const t="outline-chapters_fixed",e=this.$el,s=this.offsetTop,i=this.$scrollElement.scrollTop;return this.isClosed()||(i>=s?b(e,t):v(e,t)),this}scrollTo(t,e){return((t,e,s,i=30)=>{const r=y(t);let n=r.scrollTop,o=0;const a=e-n,c=r.scrollHeight,h=e-c<=0?e:c,u=()=>{clearTimeout(g),g=null},d=()=>{if(g&&u(),o+=3,a<0){if(n-=f(o),r.scrollTop=n,n<=e)return r.scrollTop=e,u(),l(s)&&s(e),!1}else if(n+=f(o),r.scrollTop=n,n>=h)return r.scrollTop=h,u(),l(s)&&s(h),!1;g=setTimeout(d,"number"==typeof s?s:i)};d()})(this.$scrollElement,t,e,100),this}show(){const t="outline-chapters_hidden",e=this.attr("afterOpened");return v(this.$el,t),this.isInside()&&v(this.$parentElement,t),this.closed=!1,l(e)&&e.call(this),this}hide(){const t="outline-chapters_hidden",e=this.attr("afterClosed");return b(this.$el,t),this.isInside()&&b(this.$parentElement,t),this.closed=!0,l(e)&&e.call(this),this}toggle(){return this.closed?this.show():this.hide(),this}destroy(){const t=this.attr("beforeDestroy"),e=this.attr("afterDestroy");return l(t)&&t.call(this),this.removeListeners(),this.$parentElement.removeChild(this.$el),this.attr(S.DEFAULTS),this.$el=null,this.$title=null,this.$main=null,this.$list=null,this.$placeholder=null,this.$parentElement=null,this.$scrollElement=null,this.chapters=[],this.active=0,this.offsetTop=0,this.$active=null,this.closed=!1,this.timer&&(clearTimeout(this.timer),this.timer=null),l(e)&&e.call(this),this}onObserver(){let t=null;return((t,e)=>{const s=e.root||null,i=e.selector||".outline-heading",r=e.context||null,n={rootMargin:e.rootMargin||"0px 0px -90% 0px"},o=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&l(t)&&t.call(r||e.target,e.target)}))}),n);s&&(n.root=s),document.querySelectorAll(i).forEach((t=>{o.observe(t)}))})((e=>{const s=e.getAttribute("data-id");if(this.playing)return!1;t&&clearTimeout(t),t=n((()=>{this.highlight(s)}),100)}),{context:this}),this}onSelect(t){const e=t.delegateTarget,s=e.getAttribute("data-id"),i=e.href.split("#")[1],r=document.querySelector(`#${i}`).offsetTop,o=this.$scrollElement.scrollHeight,a=this.attr("afterScroll"),c=()=>{l(a)&&a.call(this),n((()=>{this.playing=!1,N("update:toolbar",{top:r,min:0,max:o})}))};return this.playing=!0,this.isFixed()?(this.sticky(),n((()=>{this.scrollTo(r,c),this.highlight(s)}),10)):(this.scrollTo(r,c),this.highlight(s)),function(t){t.stopPropagation(),t.preventDefault()}(t),this}onScroll(){const t=this.$scrollElement;return this.timer&&clearTimeout(this.timer),this.timer=n((()=>{const e=t.scrollTop,s=t.scrollHeight-t.clientHeight;this.isFixed()&&this.sticky(),N("update:toolbar",{top:e,min:0,max:s})}),50),this}addListeners(){const t=this.$el,e=this.$scrollElement,s=e.tagName.toLowerCase();let i=e;return"html"!==s&&"body"!==s||(i=window),p(t,".outline-chapters__anchor","click",this.onSelect,this,!0),((t,e,s,i,r,n=!1)=>{const a=o.indexOf(e)>-1,c=function(l){let o=r||t;!0===r&&(o=i),!0===n&&h(t,e,c),s.call(o,l,i)};if(!l(s))return!1;t._listeners||(t._listeners=[]),t._listeners.push({el:t,type:e,fn:c,data:i,context:r,capture:a}),s._delegateListener=c,t.addEventListener(e,c,a)})(i,"scroll",this.onScroll,this,!0),this}removeListeners(){const t=this.$el,e=this.$scrollElement,s=e.tagName.toLowerCase();let i=e;return"html"!==s&&"body"!==s||(i=window),h(t,"click",this.onSelect),h(i,"scroll",this.onScroll),this}}return S.DEFAULTS={parentElement:"",scrollElement:"",selector:"",active:0,closed:!1,showCode:!0,position:"relative",chapters:[],created:null,mounted:null,afterClosed:null,afterOpened:null,afterScroll:null,beforeDestroy:null,afterDestroy:null},S}));
//# sourceMappingURL=chapters.min.js.map
