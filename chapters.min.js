!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Chapters=e()}(this,(function(){"use strict";const t=t=>"string"==typeof t,e=(t,e)=>{const s=Object.prototype.hasOwnProperty;return t&&s.call(t,e)},s=Object.prototype.toString,i=t=>"function"==typeof t||"[object Function]"===s.apply(t),r=t=>("[object Object]"===s.apply(t)||"object"==typeof t||i(t))&&null!==t;class l{constructor(t){this.attrs={},t&&this.initialize(t)}initialize(t){return this.attr(t).render().addListeners(),this}attr(s,i){const l=this.attrs;return t(s)?i&&e(l,s)?(l[s]=i,this):l[s]:r(s)?(n=l,o=s,Object.keys(o).forEach((t=>{e(o,t)&&(n[t]=o[t])})),this):0===arguments.length?l:this;var n,o}render(){return this}destroy(){return this.removeListeners(),this}reload(t){return this.destroy().initialize(this.attr(t)),this}addListeners(){return this}removeListeners(){return this}}const n=t=>r(t)&&t.nodeName&&t.tagName&&1===t.nodeType,o=(t,e=300)=>!!i(t)&&setTimeout((()=>{t()}),e),a=["focusout","blur","focusin","focus","load","unload","mouseenter","mouseleave"],c=(t,e,s)=>{const i=a.indexOf(e)>-1;s._delegateListener&&delete(s=s._delegateListener)._delegateListener,function(t,e,s){const i=t._listeners;let r=-1;if(i.length<1)return!1;i.forEach(((t,i)=>{const l=t.fn;e===t.type&&(r=i,l===s&&(r=i))})),r>-1&&i.splice(r,1)}(t,e,s),t.removeEventListener(e,s,i)},h=function(e,s,i=!1){const r=t(e)?document.querySelector(e):e,l=r.childNodes,o=((e,s)=>{let i=e._listeners||[];return t(s)&&s&&(i=i.filter((t=>t.type===s))),i})(r,s);o.forEach((t=>{c(r,t.type,t.fn)})),(i||!0===s||1===arguments.length)&&r&&l&&l.forEach((t=>{n(t)&&h(t,s,i)}))},u=(t,e,s)=>{if(!i(s))return h(t,e);c(t,e,s)},d=(t,e="")=>{const s=e.replace(/^>/i,"");return!!(e&&s&&t)&&(t.matches?t.matches(s):!!t.msMatchesSelector&&t.msMatchesSelector(s))},p=t=>t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode,m=(t,e,s,i,r,l,n=!1)=>{const o=a.indexOf(s)>-1,c=function(o){const a=function(t){const e=t.target;return(s=e)&&3===s.nodeType?s.parentNode:s;var s}(o),h=((t,e,s,i)=>{const r=s||document;if(!t)return null;do{if(null!=e&&(">"===e[0]?t.parentNode===r&&d(t,e):d(t,e))||i&&t===r)return t;if(t===r)break}while(t=p(t))})(a,e,t);let m=l||t;o.delegateTarget=h,!0===l&&(m=r),h&&(!0===n&&u(t,s,c),i.call(m,o,r))};t._listeners||(t._listeners=[]),t._listeners.push({el:t,selector:e,type:s,fn:c,data:r,context:l,capture:o}),i._delegateListener=c,t.addEventListener(s,c,o)},f=t=>Array.isArray?Array.isArray(t):"[object Array]"===s.apply(t),y=t=>{return r(t)&&(n(t)||(t=>r(t)&&"[object NodeList]"===s.apply(t))(t)||r(e=t)&&"[object DocumentFragment]"===s.call(e)||(t=>r(t)&&("[object Text]"===s.apply(t)||t.tagName&&3===t.nodeType))(t));var e},g=(s,i,l)=>{const n=document.createDocumentFragment(),o=document.createElement(s),a=e=>y(e)||t(e),c=e=>{let s;if(!a(e))return!1;y(e)?s=e:t(e)&&(s=document.createTextNode(e)),n.appendChild(s)};return r(i)?Object.keys(i).forEach((t=>{e(i,t)&&((t,e,s)=>{let i=t.tagName.toLowerCase();switch(e){case"style":t.style.cssText=s;break;case"value":"input"===i||"textarea"===i?t.value=s:t.setAttribute(e,s);break;case"className":t.className=s;break;default:t.setAttribute(e,s)}})(o,t,i[t])})):f(i)&&i.every((t=>a(t)))&&i.forEach((t=>{c(t)})),f(l)?l.forEach((t=>{c(t)})):c(l),o.appendChild(n),o},$=t=>t*t,b=(e=null)=>{let s,i;return e?t(e)?i=document.querySelector(e):n(e)&&(i=e):(s=document.querySelectorAll("html,body"),i=s[0].scrollTop-s[1].scrollTop>=0?s[0]:s[1]),i};let v=null;const E=(t,e)=>{let s=t.className;return!!s&&s.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},_=(t,e)=>{let s=t.className;if(E(t,e))return!1;s+=s.length>0?" "+e:e,t.className=s},T=(e,s)=>{let i=e.className;if(!i||!E(e,s))return!1;var r;r=i.replace(s,""),i=!!t(r)&&r.replace(/^\s+|\s+$/g,""),e.className=i},x=t=>{let e=t.offsetTop;return null!==t.offsetParent&&(e+=x(t.offsetParent)),e},N={},j=t=>e(N,t)&&N[t].length>0,S=(t,e=!0)=>e?j(t):(t=>{let e=j(t),s=t.lastIndexOf(".");for(;!e&&-1!==s;)s=(t=t.substring(0,s)).lastIndexOf("."),e=j(t);return e})(t),A=(t,e,i=!0)=>{const r=t=>{if(!j(t))return!1;N[t].forEach((t=>{const i=(r=e,["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]","[object BigInt64Array]","[object BigUint64Array]"].indexOf(s.call(r))>-1?e.toString():e);var r;t.callback.call(t.context||t,i)}))},l=()=>{let e=t,s=t.lastIndexOf(".");for(;-1!==s;)e=e.substring(0,s),s=e.lastIndexOf("."),r(e);r(t),r("*")};if(!S(t))return!1;i?setTimeout(l,10):l()};class L extends l{constructor(t){super(),this.attrs=L.DEFAULTS,this.$el=null,this.$title=null,this.$main=null,this.$list=null,this.$placeholder=null,this.$parentElement=null,this.$scrollElement=null,this.chapters=[],this.closed=!1,this.active=0,this.offsetTop=0,this.$active=null,this.timer=null,this.playing=!1,t&&this.initialize(t)}initialize(e){let s,r,l,o;return this.attr(e),s=this.attr("created"),r=this.attr("parentElement"),l=this.attr("scrollElement"),t(r)?o=document.querySelector(r):n(r)&&(o=r),this.$parentElement=o,this.$scrollElement=b(l),this.chapters=this.attr("chapters"),this.closed=this.attr("closed"),this.active=this.attr("active"),i(s)&&s.call(this),this.chapters.length<1||(this.render().addListeners(),this.$active=document.querySelector(`#chapter-${this.active}`)),this}isClosed(){return this.closed}isSticky(){return"sticky"===this.attr("position")}isFixed(){return"fixed"===this.attr("position")}isInside(){return this.isFixed()||this.isSticky()}isOutside(){return!this.isInside()}render(){const t="outline-chapters_fixed",e="outline-chapters_hidden",s=this.attr("mounted"),r=this.attr("title"),l=this.attr("showCode"),n=this.attr("customClass"),o=this.$parentElement,a=document.createDocumentFragment(),c=[];let h,u,d,p,m=null;return o?(this.isInside()&&(m=g("h2",{className:"outline-chapters__title"},[r]),this.$title=m,c.push(m)),d=g("ul",{className:`outline-chapters__list ${t} ${e}`},[""]),this.$list=d,p=g("div",{className:"outline-chapters__placeholder"},[""]),this.$placeholder=p,u=g("div",{className:"outline-chapters__main"},[d,p]),this.$main=u,c.push(u),h=g("nav",{id:"outline-chapters",className:"outline-chapters"},c),this.$el=h,this.isSticky()&&_(h,"outline-chapters_sticky"),n&&_(h,n),a.appendChild(h),o.appendChild(a),((t,e,s=!1)=>{e.forEach((e=>{const i=e.pid,r=g("span",{className:"outline-chapters__text"},[e.text]),l=g("a",{id:`outline-anchor-${e.id}`,className:"outline-chapters__anchor",href:"#"+e.rel,rel:e.rel,"data-id":e.id},[r]);let n,o,a,c,h=[];s&&(c=g("span",{className:"outline-chapters__code","data-id":e.id},[e.code]),l.insertBefore(c,l.firstChild)),h.push(l),a=g("li",{id:`outline-chapter-${e.id}`,className:"outline-chapters__item","data-id":e.id},h),-1===i?t.appendChild(a):(n=document.getElementById("outline-chapter-"+i),o=document.getElementById("outline-subject-"+i),o?o.appendChild(a):(o=g("ul",{id:"outline-subject-"+i,className:"outline-chapters__subject"},[a]),n.appendChild(o)))}))})(d,this.chapters,l),T(d,t),T(d,e),this.offsetTop=x(document.querySelector("#outline-chapters")),i(s)&&s.call(this),this.onObserver(),this):this}highlight(t){const e=this.$el.querySelector(`#outline-anchor-${t}`),s="outline-chapters_active",i=this.$placeholder;let r;return this.$active&&T(this.$active,s),this.active=parseInt(e.getAttribute("data-id"),10),this.$active=e,_(this.$active,s),r=30*this.active,i.style.top=`calc(0.5em + ${r}px)`,this}sticky(){const t="outline-chapters_fixed",e=this.$el,s=this.offsetTop,i=this.$scrollElement.scrollTop;return this.isClosed()||(i>=s?_(e,t):T(e,t)),this}scrollTo(t,e){return((t,e,s,r=50)=>{const l=b(t);let n=l.scrollTop,o=0;const a=e-n,c=l.scrollHeight,h=e-c<=0?e:c,u=()=>{clearTimeout(v),v=null},d=()=>{if(v&&u(),o+=3,a<0){if(n-=$(o),l.scrollTop=n,n<=e)return l.scrollTop=e,u(),i(s)&&s(e),!1}else if(n+=$(o),l.scrollTop=n,n>=h)return l.scrollTop=h,u(),i(s)&&s(h),!1;v=setTimeout(d,"number"==typeof s?s:r)};d()})(this.$scrollElement,t,e,100),this}show(){const t="outline-chapters_hidden",e=this.attr("afterOpened");return T(this.$el,t),this.isInside()&&T(this.$parentElement,t),this.closed=!1,i(e)&&e.call(this),this}hide(){const t="outline-chapters_hidden",e=this.attr("afterClosed");return _(this.$el,t),this.isInside()&&_(this.$parentElement,t),this.closed=!0,i(e)&&e.call(this),this}toggle(){return this.closed?this.show():this.hide(),this}destroy(){const t=this.attr("beforeDestroy"),e=this.attr("afterDestroy");return i(t)&&t.call(this),this.removeListeners(),this.$parentElement.removeChild(this.$el),this.attr(L.DEFAULTS),this.$el=null,this.$title=null,this.$main=null,this.$list=null,this.$placeholder=null,this.$parentElement=null,this.$scrollElement=null,this.chapters=[],this.active=0,this.offsetTop=0,this.$active=null,this.closed=!1,this.timer&&(clearTimeout(this.timer),this.timer=null),i(e)&&e.call(this),this}onObserver(){let t=null;return((t,e)=>{const s=e.root||null,r=e.selector||".outline-heading",l=e.context||null,n={rootMargin:e.rootMargin||"0px 0px -90% 0px"},o=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&i(t)&&t.call(l||e.target,e.target)}))}),n);s&&(n.root=s),document.querySelectorAll(r).forEach((t=>{o.observe(t)}))})((e=>{const s=e.getAttribute("data-id");if(this.playing)return!1;t&&clearTimeout(t),t=o((()=>{this.highlight(s)}),100)}),{context:this}),this}onSelect(t){const e=t.delegateTarget,s=e.getAttribute("data-id"),r=e.href.split("#")[1],l=document.querySelector(`#${r}`).offsetTop,n=this.$scrollElement.scrollHeight,a=this.attr("afterScroll"),c=()=>{i(a)&&a.call(this),o((()=>{this.playing=!1,A("update:toolbar",{top:l,min:0,max:n})}))};return this.playing=!0,this.isFixed()?(this.sticky(),o((()=>{this.scrollTo(l,c),this.highlight(s)}),10)):(this.scrollTo(l,c),this.highlight(s)),function(t){t.stopPropagation(),t.preventDefault()}(t),this}onScroll(){const t=this.$scrollElement;return this.timer&&clearTimeout(this.timer),this.timer=o((()=>{const e=t.scrollTop,s=t.scrollHeight-t.clientHeight;this.isFixed()&&this.sticky(),A("update:toolbar",{top:e,min:0,max:s})}),50),this}addListeners(){const t=this.$el,e=this.$scrollElement,s=e.tagName.toLowerCase();let r=e;return"html"!==s&&"body"!==s||(r=window),m(t,".outline-chapters__anchor","click",this.onSelect,this,!0),((t,e,s,r,l,n=!1)=>{const o=a.indexOf(e)>-1,c=function(i){let o=l||t;!0===l&&(o=r),!0===n&&u(t,e,c),s.call(o,i,r)};if(!i(s))return!1;t._listeners||(t._listeners=[]),t._listeners.push({el:t,type:e,fn:c,data:r,context:l,capture:o}),s._delegateListener=c,t.addEventListener(e,c,o)})(r,"scroll",this.onScroll,this,!0),this}removeListeners(){const t=this.$el,e=this.$scrollElement,s=e.tagName.toLowerCase();let i=e;return"html"!==s&&"body"!==s||(i=window),u(t,"click",this.onSelect),u(i,"scroll",this.onScroll),this}}return L.DEFAULTS={parentElement:"",scrollElement:"",selector:"",active:0,closed:!1,showCode:!0,position:"relative",chapters:[],created:null,mounted:null,afterClosed:null,afterOpened:null,afterScroll:null,beforeDestroy:null,afterDestroy:null},L}));
//# sourceMappingURL=chapters.min.js.map
